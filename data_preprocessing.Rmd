---
title: "Data Preprocessing"
author: "Louise Brix Pilegaard Hansen and Rikke Uldb√¶k"
date: "2023-04-16"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

#install.packages("leaflet")
#install.packages("googlesheets4")
```

```{r}
library(sp)
library(rgdal)
library(sf)
library(leaflet)
library(readxl)
library(googlesheets4)
```

# Load Google Sheets datapoints

```{r}
googlesheets4::gs4_deauth()
googlesheets4::gs4_auth()

sheets_data <- read_sheet("https://docs.google.com/spreadsheets/d/1Qdjz-TU4ispjOAkpdMw9b8wGRgpLUHeg3CjE4lzD-iQ/edit#gid=0", range = "AarhusData")

# need to divide the coordinates
sheets_data_sf <- st_as_sf(sheets_data)
```


```{r}
data <- read_excel("./data/cult_activities_aarhus.xls")
data$latitude <- as.numeric(data$Latitude)
data$longitude <- as.numeric(data$Longitude)
```

```{r}
data_sf <- data %>% 
  st_as_sf(coords = c("longitude", "latitude"), crs = 4326) %>% # i am setting, NOT transforming the CRS here. 4326 because it is longlat = unprojected crs
  st_transform(crs = 25832)
```

# OBS: these are the wrong coordinates
```{r}
c <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=as.numeric(data$Longitude), lat=as.numeric(data$Latitude), popup=data$Placename)
c  # Print the map
```

```{r}
data_sf <- data_sf %>% 
  st_transform(crs = 4326)
```

```{r}
c <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=as.numeric(data_sf$Longitude), lat=as.numeric(data_sf$Latitude), popup=data_sf$Placename)
c  # Print the map
```


# trying to extract information from the playgrounds sf frame

WORKFLOW: 
- Read in json files from folder
- read them in as a Spatial Object
- transform CRS to '4326' (= same as leaflet)
- extract coordinates
- plot in leaflet



## Read in GeoJSON data from OpenData

```{r}
playgrounds <- st_read("data/geojson_files/legepladser.json")
```

```{r}
st_crs(playgrounds)
```

The EPSG of the playgrounds object is 25832. The CRS of leaflet is 4326, so we need to transform the coordinates

```{r}
playgrounds <- playgrounds %>% 
  st_transform(crs = 4326)
```

Now leaflet and "playgrounds" have the same CRS and can be plotted:
```{r}
st_crs(playgrounds)
```

```{r}
coords_playground <- st_coordinates(playgrounds)

c <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=coords_playground[, 1], lat=coords_playground[, 2], popup = playgrounds$lokation)
c  # Print the map
```

## add two different spatial objects in same map:

```{r}
shelters <- st_read("data/geojson_files/shelter.json")

shelters <- shelters %>% 
  st_transform(crs = 4326)

shelters_coords <- st_coordinates(shelters)
```

### add to existing map
```{r}
c <- addMarkers(c, lng=shelters_coords[, 1], lat=shelters_coords[, 2], popup = shelters$navn)
c
```


## try loading vector data
```{r}
vandreruter <- st_read("data/geojson_files/vandreruter.json")
```
```{r}
vandreruter <- vandreruter %>% 
  st_transform(crs = 4326)
```

```{r}
vandre_coord <- st_coordinates(vandreruter)
```

```{r}
l <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  #addMarkers(lng=coords_playground[, 1], lat=coords_playground[, 2], popup = playgrounds$lokation)
  addPolylines(lng=vandre_coord[, 1], lat=vandre_coord[, 2])
l  # Print the map
```

